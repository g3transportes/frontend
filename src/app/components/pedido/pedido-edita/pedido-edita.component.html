<p-blockUI [blocked]="loading.Status">
    <p-progressBar mode="indeterminate"></p-progressBar>
</p-blockUI>
<p-tabView *ngIf="vm != null">
    <p-tabPanel header="Informações do Pedido">
        <div class="p-grid">
            <div class="p-col-12 p-md-2 p-lg-2 ui-fluid form-item">
                <label>Ordem de Serviço</label>
                <input type="text" pInputText [(ngModel)]="vm.OrdemServico" disabled> 
            </div>
            <div class="p-col-12 p-md-2 p-lg-2 ui-fluid form-item">
                <label>Num. Pedido</label>
                <input type="text" pInputText [(ngModel)]="vm.NumPedido"> 
            </div>
            <div class="p-col-12 p-md-2 p-lg-2 ui-fluid form-item">
                <label>Data</label>
                <p-calendar appendTo="body" [(ngModel)]="vm.DataCriacao" [showIcon]="true" [locale]="localeBR" dateFormat="dd/mm/yy" showButtonBar="true" (onSelect)="onOrdemServico_Change()" (onClearClick)="onOrdemServico_Change()" (keyup.enter)="onOrdemServico_Change()"></p-calendar>
            </div>
            <div class="p-col-12 p-md-3 p-lg-3 ui-fluid form-item">
                <label>Cliente</label>
                <p-dropdown appendTo="body" [options]="clientes" [(ngModel)]="vm.IdCliente" [filter]="true" (onChange)="onCliente_Change()"></p-dropdown>
            </div>
            <div class="p-col-12 p-md-3 p-lg-3 ui-fluid form-item">
                <label>Caminhão</label>
                <p-dropdown appendTo="body" [options]="caminhoes" [(ngModel)]="vm.IdCaminhao" [filter]="true" (onChange)="onOrdemServico_Change()"></p-dropdown>
            </div>

            <div class="p-col-12 p-md-2 p-lg-2 ui-fluid form-item">
                <label>Coleta</label>
                <p-calendar appendTo="body" [(ngModel)]="vm.DataColeta" [showIcon]="true" [locale]="localeBR" dateFormat="dd/mm/yy" showButtonBar="true" [disabled]="vm.Coletado == false"></p-calendar>
            </div>
            <div class="p-col-12 p-md-2 p-lg-2 ui-fluid form-item">
                <label>Entrega</label>
                <p-calendar appendTo="body" [(ngModel)]="vm.DataEntrega" [showIcon]="true" [locale]="localeBR" dateFormat="dd/mm/yy" showButtonBar="true" [disabled]="vm.Entregue == false"></p-calendar>
            </div>
            <div class="p-col-12 p-md-4 p-lg-4 ui-fluid form-item">
                <label>Remetente</label>
                <p-dropdown appendTo="body" [options]="remetentes" [(ngModel)]="vm.IdRemetente" [filter]="true"></p-dropdown>
            </div>
            <div class="p-col-12 p-md-3 p-lg-3 ui-fluid form-item">
                <label>Local da Coleta</label>
                <input type="text" pInputText [(ngModel)]="vm.LocalColeta"> 
            </div>
            <div class="p-col-12 p-md-1 p-lg-1 ui-fluid form-item">
                <label>Paletes</label>
                <input type="number" pInputText [(ngModel)]="vm.Paletes"> 
            </div>
            
            <div class="p-col-12 form-item">
                <hr>
            </div>

            <div class="p-col-12 p-md-2 p-lg-2 ui-fluid form-item">
                <label>Qtde. Total</label>
                <input type="text" [(ngModel)]="vm.Quantidade" decimal2Mask (ngModelChange)="onQuantidade_Change()"> 
            </div>

            <div class="p-col-12 p-md-2 p-lg-2 ui-fluid form-item">
                <label>Frete x Tonelada</label>
                <input type="text" dinheiroMask [(ngModel)]="vm.FreteUnitario" dinheiroMask (ngModelChange)="onFreteTonelada_Change()"> 
            </div>

            <div class="p-col-12 p-md-2 p-lg-2 ui-fluid form-item">
                <label>Pedágio Freteiro</label>
                <input type="text" dinheiroMask [(ngModel)]="vm.ValorPedagioCliente" dinheiroMask (ngModelChange)="onFreteTonelada_Change()"> 
            </div>

            <div class="p-col-12 p-md-2 p-lg-2 ui-fluid form-item">
                <label>Pedágio G3</label>
                <input type="text" [(ngModel)]="vm.ValorPegadioG3" dinheiroMask (ngModelChange)="onComissaoTonelada_Change()"> 
            </div>

            <div class="p-col-12 p-md-2 p-lg-2 ui-fluid form-item">
                <label>Frete Total</label>
                <input type="text" dinheiroMask [(ngModel)]="vm.ValorFrete" dinheiroMask (ngModelChange)="onFreteTotal_Change()"> 
            </div>

            <div class="p-col-12 p-md-2 p-lg-2 ui-fluid form-item">
                <label>G3 x Tonelada</label>
                <input type="text" [(ngModel)]="vm.ComissaoUnitario" dinheiroMask (ngModelChange)="onComissaoTonelada_Change()"> 
            </div>

            

            <div class="p-col-12 p-md-2 p-lg-2 ui-fluid form-item">
                <label>G3 Bruto</label>
                <input type="text" [(ngModel)]="vm.ValorComissao" dinheiroMask (ngModelChange)="onComissaoTotal_Change()"> 
            </div>

            <div class="p-col-12 p-md-2 p-lg-2 ui-fluid form-item">
                <label>Valor Bruto</label>
                <input type="text" [(ngModel)]="vm.ValorBruto" dinheiroMask disabled> 
            </div>

            <div class="p-col-12 p-md-2 p-lg-2 ui-fluid form-item">
                <label>Valor Unitário</label>
                <input type="text" [(ngModel)]="vm.ValorUnitario" dinheiroMask disabled>
            </div>
            
            <!--
            <div class="p-col-12 p-md-2 p-lg-2 ui-fluid form-item">
                <label>Pedágio</label>
                <input type="text" [(ngModel)]="vm.ValorPedagio" dinheiroMask (ngModelChange)="onPedagio_Change()"> 
            </div>
            -->

            <div class="p-col-12 p-md-2 p-lg-2 ui-fluid form-item">
                <label>Despesas</label>
                <input type="text" [(ngModel)]="vm.ValorAcrescimo" dinheiroMask (ngModelChange)="onDespesas_Change()"> 
            </div>

            <div class="p-col-12 p-md-2 p-lg-2 ui-fluid form-item">
                <label>Descontos</label>
                <input type="text" [(ngModel)]="vm.ValorDesconto" dinheiroMask (ngModelChange)="onDesconto_Change()"> 
            </div>

            <div class="p-col-12 p-md-2 p-lg-2 ui-fluid form-item">
                <label>Líquido G3</label>
                <input type="text" [(ngModel)]="vm.ValorLiquido" dinheiroMask disabled> 
            </div>

            <div class="p-col-12 p-md-2 p-lg-2 ui-fluid form-item">
                <label>Margem G3</label>
                <input type="text" [(ngModel)]="vm.ComissaoMargem" dinheiroMask disabled> 
            </div>

            <div class="p-col-12 form-item">
                <hr>
            </div>
            
            <div class="p-col-12 p-md-4 p-lg-4 ui-fluid form-item">
                <label>CTe</label>
                <input type="text" pInputText [(ngModel)]="vm.CTe"> 
            </div>
            <div class="p-col-12 p-md-4 p-lg-4 ui-fluid form-item">
                <label>NFe</label>
                <input type="text" pInputText [(ngModel)]="vm.NFe"> 
            </div>
            <div class="p-col-12 p-md-4 p-lg-4 ui-fluid form-item">
                <label>Boleto</label>
                <input type="text" pInputText [(ngModel)]="vm.Boleto"> 
            </div>

            
            
            <div class="p-col-12 ui-fluid form-item">
                <label>Observações</label>
                <textarea [rows]="2" pInputTextarea [(ngModel)]="vm.Observacao"></textarea> 
            </div>


            <div class="p-col-12 p-md-3 lg-3">
                <p-checkbox label="Pedido Coletado" [(ngModel)]="vm.Coletado" binary="true" disabled></p-checkbox>
            </div>
            <div class="p-col-12 p-md-3 lg-3">
                <p-checkbox label="Pedido Entregue" [(ngModel)]="vm.Entregue" binary="true" disabled></p-checkbox>
            </div>
            <div class="p-col-12 p-md-3 lg-3">
                <p-checkbox label="Pedido Pago" [(ngModel)]="vm.Pago" binary="true" disabled></p-checkbox>
            </div>
            <div class="p-col-12 p-md-3 lg-3">
                <p-checkbox label="Registro ativo" [(ngModel)]="vm.Ativo" binary="true" disabled></p-checkbox>
            </div>
        </div>
    </p-tabPanel>
    <p-tabPanel header="Anexos">
        <p-toolbar>
            <div class="ui-toolbar-group-right">
                <button pButton type="button" icon="pi pi-upload" iconPos="left" label="Adicionar Arquivo" (click)="onAdicionaAnexo_Click()"></button>
            </div>
        </p-toolbar>
        
        <p-table [value]="vm.Anexos">
            <ng-template pTemplate="header">
                <tr>
                    <th>Arquivo</th>
                    <th style="width: 100px">Ações</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-anexo>
                <tr>
                    <td>
                        <a [href]="anexo.Anexo.Arquivo" target="_blank">
                            {{ anexo.Anexo.Nome }}
                        </a>
                    </td>
                    <td class="text-align-center">
                        <a class="action-danger" (click)="onDeletaAnexo_Click(anexo)">
                            <i class="pi pi-times"></i>
                        </a>
                    </td>
                </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="2" class="text-align-center">
                        Nenhum registro encontrado
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </p-tabPanel>
</p-tabView>

<div class="form-footer">
    <button pButton type="button" icon="pi pi-plus" iconPos="left" label="Cadastrar Cliente" class="float-left ui-button-secondary" (click)="onAdicionaCliente_Click()" [disabled]="loading.Status"></button>
    <button pButton type="button" icon="pi pi-plus" iconPos="left" label="Cadastrar Caminhão" class="float-left ui-button-secondary" (click)="onAdicionaCaminhao_Click()" [disabled]="loading.Status"></button>
    <button pButton type="button" icon="pi pi-plus" iconPos="left" label="Cadastrar Remetente" class="float-left ui-button-secondary" (click)="onAdicionaRemetente_Click()" [disabled]="loading.Status"></button>
    <button pButton type="button" icon="pi pi-plus" iconPos="left" label="Movimenta Estoque" class="float-left ui-button-secondary" (click)="onAdicionaEstoque_Click()" [disabled]="loading.Status"></button>

    <button pButton type="button" icon="pi pi-save" iconPos="left" label="Salvar Registro" class="float-right" (click)="onSalvar_Click()" [disabled]="loading.Status"></button>
</div>
